package com.Notes;

import java.time.Duration;
import java.util.Random;

import org.openqa.selenium.By;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.edge.EdgeDriver;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.Select;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.testng.Assert;
import org.testng.annotations.AfterTest;
import org.testng.annotations.BeforeTest;
import org.testng.annotations.Test;

public class Create_Notes {
	WebDriver driver;
	JavascriptExecutor js;
	Random randomGenerator = new Random();  
	int randomInt = randomGenerator.nextInt(100000000);
	String UserName;
	WebDriverWait wait;
	 
   

	@BeforeTest
	public void pre_condition() {

		driver = new EdgeDriver();
		driver.manage().window().maximize();
		//driver.get("https://practice.expandtesting.com/notes/app");
		driver.get("https://practice.expandtesting.com/notes/app/login");
		driver.navigate().refresh();
		driver.manage().timeouts().implicitlyWait(Duration.ofSeconds(5));
		js = (JavascriptExecutor) driver;

	}

	@AfterTest
	public void post_condition() {
		WebElement logout = driver.findElement(By.xpath("//button[normalize-space()='Logout']"));
		js.executeScript("arguments[0].scrollIntoView(true);", logout);
		logout.click();
		driver.close();
	}

	@Test(priority=1)
	public void login_to_app() {
		
//		WebElement login = driver.findElement(By.linkText("Login"));
//		js.executeScript("arguments[0].scrollIntoView(true);", login);
//		login.click();
//		js.executeScript("window.scrollTo(0, document.body.scrollHeight);");
		
		driver.findElement(By.id("email")).clear();
		driver.findElement(By.id("email")).sendKeys("sindhura77@gmail.com");
		driver.findElement(By.id("password")).clear();
		driver.findElement(By.id("password")).sendKeys("Yellow");
		
		
		WebElement login = driver.findElement(By.xpath("//button[text()='Login']"));
		js.executeScript("arguments[0].scrollIntoView(true);", login);
		login.click();

		//Verify Logout Button is displayed
		driver.findElement(By.xpath("//button[normalize-space()='Logout']")).isDisplayed();	
	}
	
	
	@Test(priority=2)
	public void create_Note() 
	{
		driver.findElement(By.xpath("//button[contains(text(), 'Add Note')]")).click();
		
		Select noteCategory = new Select(driver.findElement(By.name("category")));
		noteCategory.selectByValue("Work");
		
		UserName = "Testing"+randomInt;
		
		driver.findElement(By.name("title")).clear();
		driver.findElement(By.name("title")).sendKeys(UserName);
		
		driver.findElement(By.id("description")).clear();
		driver.findElement(By.id("description")).sendKeys("Testing description");
		
		driver.findElement(By.xpath("//button[normalize-space()='Create']")).click();
		
		Boolean result = driver.findElement(By.xpath("//div[contains(text(), '"+UserName+"')]")).isDisplayed();
		driver.findElement(By.xpath("//p[contains(text(), 'Testing description')]")).isDisplayed();
		Assert.assertEquals(result, true);
			
	}
	
	@Test(priority=3,enabled=false)
	public void edit_Note() 
	{
		WebElement editUser=driver.findElement(By.xpath("//div[text()='"+UserName+"']//following-sibling::div//button[text()='Edit']"));
		js.executeScript("arguments[0].scrollIntoView(true);", editUser);
		editUser.click();
		
		driver.findElement(By.name("description")).clear();
		driver.findElement(By.name("description")).sendKeys("New Description");
		driver.findElement(By.xpath("//button[text()='Save']")).click();
		
		//js.executeScript("arguments[0].scrollIntoView(true);", editUser);
		
		
	}
	
	@Test(priority=4)
	public void delete_Note() 
	{
		driver.navigate().refresh();
		WebElement deleteUser=driver.findElement(By.xpath("//div[text()='"+UserName+"']//following-sibling::div//button[text()='Delete']"));
		
		js.executeScript("arguments[0].scrollIntoView(true);", deleteUser);
		
		deleteUser.click();
		driver.findElement(By.xpath("//button[@data-testid='note-delete-confirm']")).click();
	}
	
}
